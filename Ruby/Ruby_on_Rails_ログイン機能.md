#### Progate Ruby on Rails5 VIII
(2022.6.3)

## ログイン機能
- ログインするためには、ログインページからメールアドレスやパスワードなどの情報をRailsに送信し、その情報を元に操作しているユーザーを特定し、ログイン状態とする。
- ログインフォームの作成  
→（パスワードカラムとバリデーションの作成）  
→フォームの値を送信できるようにする  
1.ユーザーの特定  
コントローラでfind_byとparamsを使って、usersテーブルから入力された値（emailとパスワード）に一致するユーザーを取得して@変数に代入する。  
2.特定したユーザーでログインする  
session変数（**session[:キー] = 値** ）を使うことで、ページを移動してもユーザー情報を保持し続けられる。  
sessionに代入された値は、ブラウザ(InternetExplorer, GoogleChrome等)に保存され、ブラウザはそれ以降のアクセスでsessionの値をRailsに送信する。


## ログアウト機能
- session[:user_id]の値を「特定したユーザーのid」から「nil」にする。- 

## アクセス制限で定義するメソッド
- authenticate_user→未ログインの時はログインページへリダイレクトさせる**ユーザー認証** のメソッド
- forbid_login_user→**ログインユーザーがアクセスできない** ようにするメソッド。

## ログインユーザーのみユーザー情報を編集できる
- リンクの非表示の設定
- ensure_correct_userメソッドを定義して、ログイン中のユーザーのidと編集したいユーザーのidが等しいか判定させる。

### 補足
- paramsで取得できる値は文字列
- ルーティングのURLが同じでも、HTTPメソッドが異なっていれば**異なるルーティング** として扱われる。  
link_toメソッドはgetのルーティングが、フォームヘルパーはHTTP POSTメソッドのルーティングをデフォルトで探す。
- getとpostの使い分けとして、データベースの変更の有無も一つ。
- application.html.erbの<%= yield %>部分に各アクションに対応したビューファイルが代入され表示されている。そのため、application.html.erbは全アクションから呼び出されている。  
application.html.erbでアクション側の変数を使おうとすると全アクションに定義する必要があるが、before_actionを使うことでアクションが呼び出される際に必ずbefore_actionの処理が実行される。

<img width="40%" alt="before_actionについての画像" src="https://user-images.githubusercontent.com/97078291/171814411-9892c183-8fe4-4050-936a-0397f1f1b20e.png">
