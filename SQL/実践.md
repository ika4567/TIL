#### Progate SQL Ⅱ
(2022.7.6)

## 検索結果の加工
- 「**DISTINCT**」をSELECTで取得するカラムに用いて「**SELECT DISTINCT(カラム名)**」とすると、検索結果から指定したカラムの重複データを除くことができる。
- SQLも四則演算が可能。SELECTでカラムに使うと計算ができるようになる。


## 集計関数
- SELECTで取得したカラムに使うことができる。WHEREと併用することで、データの合計や平均などの集計結果を出すことができる。
- SUM関数は「**SUM(カラム名)**」のようにすると、指定したカラムに保存されたデータの**合計**を計算することができる。  
また、WHEREと併用することで、検索したレコードの合計値を求めることもできる。
<img width="60%" alt="スクリーンショット 2022-07-10 23 48 11" src="https://user-images.githubusercontent.com/97078291/178149855-da82de4f-f645-40cf-aac9-c8bebf580da4.png">

- AVG関数は「**AVG(カラム名)**」のようにすると、指定したカラムに保存されたデータの**平均**を計算することができる。
- COUNT関数は「**COUNT(カラム名)**」のように用いることで、指定したカラムの**データの合計数**を計算してくれる関数。  
nullになっているデータの数は計算されないため、含めたい場合はアスタリスク（＊）を使うと全てのカラムを指定できる。なお、この場合はカラムではなくレコードの数を計算する。
- MAX・MIN関数は「**MAX(カラム名)**」「**MIN(カラム名)**」のように用いることで、指定したカラムのデータの中から**最大のデータ**と**最小のデータ**を取得することができる。

## データのグループ化
- 日付など同じデータごとに集計関数を使うことをグループ化という。
- **GROUP BY**を用い、FROMの後ろに「**GROUP BY カラム名**」を追加することで、指定したカラムで完全に同一のデータを持つレコードどうしが同じグループとなる。  
ただし、GROUP BYを用いる場合、SELECTで使えるのは**GROUP BYに指定しているカラム名**と、**集計関数**のみ。
<img width="60%" alt="スクリーンショット 2022-07-13 11 07 04" src="https://user-images.githubusercontent.com/97078291/178635670-6eb67df9-6885-468e-94d4-e5cc493cd6f5.png"> <img width="30%" alt="スクリーンショット 2022-07-13 11 07 46" src="https://user-images.githubusercontent.com/97078291/178635741-d9674907-c00d-451c-86e1-9b92cf184066.png">

- カラム名同士をコンマで繋げることで複数カラムを使ったグループ化ができる。
- WHEREとの併用ができ、その場合はWHEREの後ろにGROUP BYを書く。  
WHEREとGROUP BYと集計関数は下図の順番で実行される。
<img width="60%" alt="スクリーンショット 2022-07-13 11 49 51" src="https://user-images.githubusercontent.com/97078291/178640351-ecfabcf9-0a0f-4a7f-bd42-8b32f18a5971.png">

- グループ化したデータを更に絞り込む場合は**HAVING**を用い、「GROUP BY カラム名 **HAVING 条件**」とすることで、条件を満たすグループを取得することができる。  
WHEREはグループ化される前の**テーブル全体**を検索対象とするのに対し、HAVINGはGROUP BYによって**グループ化されたデータ**を検索対象とする。  
HAVINGはグループ化された後のテーブルから検索するため、条件文で使うカラムは必ずグループ化されたテーブルのカラムを使う。
<img width="60%" alt="スクリーンショット 2022-07-13 12 23 13" src="https://user-images.githubusercontent.com/97078291/178643915-d5ca6702-ce15-4ebe-89ec-88081bf3f58d.png">
<img width="60%" alt="スクリーンショット 2022-07-13 12 28 30" src="https://user-images.githubusercontent.com/97078291/178644444-5153899f-b6bc-44f1-9d2e-1d1deec19485.png">

